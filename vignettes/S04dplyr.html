<!DOCTYPE html>
<html>
<head>
  <title>Manipulation de données avec dplyr</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Manipulation de données avec dplyr',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                      },

      // Author information
      presenters: [
            {
        name:  'Vincent Guillemot<br/>Amaury Vaysse' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script src="S04dplyr_files/header-attrs-2.28/header-attrs.js"></script>
  <link href="S04dplyr_files/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="S04dplyr_files/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="S04dplyr_files/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="S04dplyr_files/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/hammer.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="S04dplyr_files/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    details > summary > p:only-child {
      display: inline;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { color: #008000; } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { color: #008000; font-weight: bold; } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
  </style>

  <link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body style="opacity: 0">

<slides>

  <slide class="title-slide segue nobackground">
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
          </hgroup>
  </slide>

<style>
.forceBreak { -webkit-column-break-after: always; break-after: column; }
</style>

<slide class=""><hgroup><h2>Avant toutes choses</h2></hgroup><article  id="avant-toutes-choses">

<ul>
<li>On crée un projet</li>
<li>On crée un script</li>
<li>On charge les données <code>fruits</code></li>
</ul>

<pre class = 'prettyprint lang-r'>library(dplyr)
data(&quot;fruits&quot;, package = &quot;minidebuter&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Fruits est un fait un &ldquo;tibble&rdquo;</h2></hgroup><article  id="fruits-est-un-fait-un-tibble">

<pre class = 'prettyprint lang-r'>fruits
#&gt; # A tibble: 51 × 18
#&gt;    nom           groupe Energie   Eau Proteines Glucides Lipides Sucres
#&gt;    &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 Abricot       crus       194  87.1      0.81     9.01    0.25    6.7
#&gt;  2 Abricot       secs      1010  24.7      2.88    59.1     0.5    34.3
#&gt;  3 Ananas        exoti…     304  81.3      0.94    15.1     0.25   14.9
#&gt;  4 Banane        exoti…     383  75.8      1.06    19.7     0.25   15.6
#&gt;  5 Canneberge    secs      1410  14.6      0.25    76.4     1      72.8
#&gt;  6 Cerise        crus       235  85.7      0.81    13       0.25   10  
#&gt;  7 Citron        crus       118  91.3      0.25     1.56    0.25    0.8
#&gt;  8 Clementine    crus       200  87        0.81     9.17    0.25    8.6
#&gt;  9 CompoteMulti… compo…     279  82.9      0.25    15.3     0.08   14.6
#&gt; 10 CompotePomme  compo…     432  72.9      0.23    24.4     0.21   20.7
#&gt; # ℹ 41 more rows
#&gt; # ℹ 10 more variables: Fructose &lt;dbl&gt;, Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;,
#&gt; #   Magnesium &lt;dbl&gt;, Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;,
#&gt; #   BetaCarotene &lt;dbl&gt;, VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;
class(fruits)
#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Bref, c’est quoi un <code>tibble</code> ?</h2></hgroup><article  id="bref-cest-quoi-un-tibble">

</article></slide><slide class=""><hgroup><h2>Mise à jour de la table des classes d’objets !</h2></hgroup><article  id="mise-à-jour-de-la-table-des-classes-dobjets">

<table class = 'rmdtable'>
<tr class="header">
<th align="left">Nom</th>
<th align="left">Appelation officielle</th>
<th align="left">Exemple</th>
</tr>
<tr class="odd">
<td align="left">Vecteur</td>
<td align="left">???</td>
<td align="left"><code>1:10</code></td>
</tr>
<tr class="even">
<td align="left">Facteur</td>
<td align="left"><code>factor</code></td>
<td align="left"><code>gl(2, 2)</code></td>
</tr>
<tr class="odd">
<td align="left">Matrice</td>
<td align="left"><code>matrix</code></td>
<td align="left"><code>matrix(1:4, 2, 2)</code></td>
</tr>
<tr class="even">
<td align="left">Tableau</td>
<td align="left"><code>data.frame</code></td>
<td align="left"><code>mtcars</code></td>
</tr>
<tr class="odd">
<td align="left">Tableau</td>
<td align="left"><code>tibble</code></td>
<td align="left"><code>fruits</code></td>
</tr>
<tr class="even">
<td align="left">Liste</td>
<td align="left"><code>list</code></td>
<td align="left"><code>list(a = 1, b = 1:10, c = &quot;Hello!&quot;)</code></td>
</tr>
<tr class="odd">
<td align="left">Fonction</td>
<td align="left"><code>function</code></td>
<td align="left"><code>sin</code>, <code>exp</code>, <code>log</code></td>
</tr>
</table>

</article></slide><slide class=""><hgroup><h2>Comment créer une nouvelle colonne ?</h2></hgroup><article  id="comment-créer-une-nouvelle-colonne">

<p>Par sécurité : je crée une copie de mes données</p>

<pre class = 'prettyprint lang-r'>fruits2 &lt;- fruits</pre>

<p>On utilise le plus souvent l’opérateur <code>$</code> :</p>

<pre class = 'prettyprint lang-r'>fruits2$Sucres_ratio &lt;- fruits2$Sucres / 100</pre>

</article></slide><slide class=""><hgroup><h2>Le principe de l’ajout de colonne</h2></hgroup><article  id="le-principe-de-lajout-de-colonne">

<p>Sur un tableau <code>tab</code>, je souhaite ajouter la colonne <code>A</code> :</p>

<pre >tab$A &lt;- nouvelles_valeurs</pre>

<p>Attention :</p>

<ul>
<li>Si la colonne <code>A</code> existe déjà, les valeurs sont écrasée</li>
<li>Si les nouvelles valeurs ne sont pas de la bonne longueur, elles sont recyclées</li>
<li>Sans rien dire pour les <code>data.frame</code>, avec une erreur pour les <code>tibble</code></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Exemple d’erreur</h2></hgroup><article  id="exemple-derreur">

<pre class = 'prettyprint lang-r'>fruits2$recyclage &lt;- c(0, 1)</pre>

<pre >Erreur : Assigned data `c(0, 1)` must be compatible with existing data.
x Existing data has 51 rows.
x Assigned data has 2 rows.
ℹ Only vectors of size 1 are recycled.
Run `rlang::last_error()` to see where the error occurred.</pre>

</article></slide><slide class=""><hgroup><h2>Exemple d’horreur !</h2></hgroup><article  id="exemple-dhorreur">

<pre class = 'prettyprint lang-r'>mtcars2 &lt;- mtcars
mtcars2$recyclage &lt;- c(0, 1)
mtcars2$recyclage
#&gt;  [1] 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Le tydiverse</h2></hgroup><article  id="le-tydiverse">

</article></slide><slide class=""><hgroup><h2>Enchaîner les commandes avec magrittr</h2></hgroup><article  id="enchaîner-les-commandes-avec-magrittr" class="columns-2">

<ul>
<li>On utilise un opérateur</li>
</ul>

<div class="centered">
<p><code>%&gt;%</code></p></div>

<ul>
<li>Avant : <code>f(g(x))</code></li>
<li>Après : <code>g(x) %&gt;% f()</code></li>
</ul>

<img width="30%" src='img/S04dplyr/maggritr.jpeg' title=''/>

</article></slide><slide class=""><hgroup><h2>Exemple</h2></hgroup><article  id="exemple" class="columns-2 bigger">

<pre class = 'prettyprint lang-r'>## Histogramme
hist(fruits$Energie)</pre>

<p><img src="S04dplyr_files/figure-html/unnamed-chunk-1-1.png" width="70%" style="display: block; margin: auto;" /></p>

<p class="forceBreak">

</p>

<pre class = 'prettyprint lang-r'>library(magrittr)
fruits$Energie %&gt;% hist()</pre>

<p><img src="S04dplyr_files/figure-html/unnamed-chunk-2-1.png" width="70%" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Le tidyverse</h2></hgroup><article  id="le-tidyverse" class="bigger">

<p>Tidyverse: <a href='https://www.tidyverse.org/' title=''>https://www.tidyverse.org/</a></p>

<div class="centered">
<img width="70%" src='img/S04dplyr/tidyverse.jpg' title=''/></div>

</article></slide><slide class=""><hgroup><h2>Charger les packages</h2></hgroup><article  id="charger-les-packages">

<p>Charger le package <code>dplyr</code>…</p>

<pre class = 'prettyprint lang-r'>library(dplyr) # ou require(dplyr)</pre>

<p>Ou bien charger <code>tidyverse</code>…</p>

<pre class = 'prettyprint lang-r'>library(tidyverse)</pre>

<p>… mais cela chargera d’autres packages en plus</p>

</article></slide><slide class=""><hgroup><h2>Le format &ldquo;tibble&rdquo;</h2></hgroup><article  id="le-format-tibble" class="smaller">

<p>Les données sont au format &ldquo;tibble&rdquo; : c’est comme des &ldquo;data-frames&rdquo; mais en mieux !</p>

<pre class = 'prettyprint lang-r'>fruits
#&gt; # A tibble: 51 × 18
#&gt;    nom           groupe Energie   Eau Proteines Glucides Lipides Sucres
#&gt;    &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 Abricot       crus       194  87.1      0.81     9.01    0.25    6.7
#&gt;  2 Abricot       secs      1010  24.7      2.88    59.1     0.5    34.3
#&gt;  3 Ananas        exoti…     304  81.3      0.94    15.1     0.25   14.9
#&gt;  4 Banane        exoti…     383  75.8      1.06    19.7     0.25   15.6
#&gt;  5 Canneberge    secs      1410  14.6      0.25    76.4     1      72.8
#&gt;  6 Cerise        crus       235  85.7      0.81    13       0.25   10  
#&gt;  7 Citron        crus       118  91.3      0.25     1.56    0.25    0.8
#&gt;  8 Clementine    crus       200  87        0.81     9.17    0.25    8.6
#&gt;  9 CompoteMulti… compo…     279  82.9      0.25    15.3     0.08   14.6
#&gt; 10 CompotePomme  compo…     432  72.9      0.23    24.4     0.21   20.7
#&gt; # ℹ 41 more rows
#&gt; # ℹ 10 more variables: Fructose &lt;dbl&gt;, Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;,
#&gt; #   Magnesium &lt;dbl&gt;, Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;,
#&gt; #   BetaCarotene &lt;dbl&gt;, VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Les fonctions de dplyr</h2></hgroup><article  id="les-fonctions-de-dplyr" class="smaller">

<p>Nous allons voir ensemble quelques fonctions très pratiques de la librairie <code>dplyr</code>.</p>

<table class = 'rmdtable'>
<tr class="header">
<th align="left">#</th>
<th align="center">Fonction (US)</th>
<th align="center">Fonction (UK)</th>
<th align="left">Description</th>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="center"><code>mutate</code></td>
<td align="center"><code>mutate</code></td>
<td align="left">Créer ou modifier des colonnes</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="center"><code>select</code></td>
<td align="center"><code>select</code></td>
<td align="left">Sélectionner des colonnes</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="center"><code>relocate</code></td>
<td align="center"><code>relocate</code></td>
<td align="left">Ré-arranger des colonnes</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="center"><code>arrange</code></td>
<td align="center"><code>arrange</code></td>
<td align="left">Trier les lignes</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="center"><code>filter</code></td>
<td align="center"><code>filter</code></td>
<td align="left">Sélectionner des lignes</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="center"><code>group_by</code></td>
<td align="center"><code>group_by</code></td>
<td align="left">Grouper des lignes</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="center"><code>summarize</code></td>
<td align="center"><code>summarise</code></td>
<td align="left">Résumer des groupes</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="center"><code>count</code></td>
<td align="center"><code>count</code></td>
<td align="left">Compter</td>
</tr>
</table>

</article></slide><slide class=""><hgroup><h2></h2></hgroup><article  id="section">

<img width="100%" src='img/S04dplyr/dplyr_wrangling.jpeg' title=''/>

</article></slide><slide class=""><hgroup><h2>Créer ou modifier des colonnes</h2></hgroup><article  id="créer-ou-modifier-des-colonnes" class="columns-2 smaller">

<p>Avec la fonction <code>mutate</code>.</p>

<pre class = 'prettyprint lang-r'>fruits2 &lt;- fruits %&gt;% 
  mutate(Sucres_ratio = Sucres / 100)

head(fruits2[, &quot;Sucres_ratio&quot;])
#&gt; # A tibble: 6 × 1
#&gt;   Sucres_ratio
#&gt;          &lt;dbl&gt;
#&gt; 1        0.067
#&gt; 2        0.343
#&gt; 3        0.149
#&gt; 4        0.156
#&gt; 5        0.728
#&gt; 6        0.1</pre>

<p>Avec les fonctions classiques.</p>

<pre class = 'prettyprint lang-r'>fruits2 &lt;- fruits
fruits2$Sucres_ratio &lt;- 
  fruits2$Sucres / 100
head(fruits2[, &quot;Sucres_ratio&quot;])
#&gt; # A tibble: 6 × 1
#&gt;   Sucres_ratio
#&gt;          &lt;dbl&gt;
#&gt; 1        0.067
#&gt; 2        0.343
#&gt; 3        0.149
#&gt; 4        0.156
#&gt; 5        0.728
#&gt; 6        0.1</pre>

</article></slide><slide class=""><hgroup><h2>Sélectionner des colonnes</h2></hgroup><article  id="sélectionner-des-colonnes" class="columns-2">

<p>Avec la fonction <code>select</code>.</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  select(
    Energie,
    Sucres,
    Lipides,
    Proteines)</pre>

<p>Avec les fonctions classiques.</p>

<pre class = 'prettyprint lang-r'>fruits[, 
  c(
    &quot;Energie&quot;,
    &quot;Sucres&quot;,
    &quot;Lipides&quot;,
    &quot;Proteines&quot;)]</pre>

</article></slide><slide class=""><hgroup><h2>Sélectionner des colonnes - bis</h2></hgroup><article  id="sélectionner-des-colonnes---bis">

<p>la fonction <code>select</code> est très versatile !</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  select(Energie:Proteines, - Eau)</pre>

<p>On peut sélectionner des plages entières de colonnes sur la base de leurs noms, en enlever avec le <code>-</code>, combiner tout cela avec la fonction <code>c()</code>… ou pas !</p>

<p><strong>Attention, la flexibilité a un coût !</strong></p>

</article></slide><slide class=""><hgroup><h2>Trier des lignes</h2></hgroup><article  id="trier-des-lignes" class="columns-2 smaller">

<p>Avec les fonctions <code>arrange</code> et <code>desc</code>.</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  select(Energie, Sucres, Fibres) %&gt;%
  arrange(desc(Fibres))
#&gt; # A tibble: 51 × 3
#&gt;    Energie Sucres Fibres
#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1    1010  34.3     8.3
#&gt;  2     425   8.5     6.8
#&gt;  3    1410  72.8     5.7
#&gt;  4     198   6.1     5.2
#&gt;  5     969  38.1     5.1
#&gt;  6     289   6.63    4.6
#&gt;  7     206   5.4     4.3
#&gt;  8     170   2.1     4.3
#&gt;  9    1360  70.3     4.2
#&gt; 10     293  12.2     4.1
#&gt; # ℹ 41 more rows</pre>

<p class="forceBreak">

</p>

<p>Avec les fonctions classiques</p>

<pre class = 'prettyprint lang-r'>fruits[
  order(fruits$Fibres, decreasing = TRUE),
  c(&quot;Energie&quot;, &quot;Sucres&quot;, &quot;Fibres&quot;)]
#&gt; # A tibble: 51 × 3
#&gt;    Energie Sucres Fibres
#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1    1010  34.3     8.3
#&gt;  2     425   8.5     6.8
#&gt;  3    1410  72.8     5.7
#&gt;  4     198   6.1     5.2
#&gt;  5     969  38.1     5.1
#&gt;  6     289   6.63    4.6
#&gt;  7     206   5.4     4.3
#&gt;  8     170   2.1     4.3
#&gt;  9    1360  70.3     4.2
#&gt; 10     293  12.2     4.1
#&gt; # ℹ 41 more rows</pre>

</article></slide><slide class=""><hgroup><h2>Sélectionner des lignes</h2></hgroup><article  id="sélectionner-des-lignes" class="columns-2 smaller">

<p>Avec la fonction <code>filter</code>.</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  filter(Sucres &gt; 60)
#&gt; # A tibble: 2 × 18
#&gt;   nom   groupe Energie   Eau Proteines Glucides Lipides Sucres Fructose
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Cann… secs      1410  14.6      0.25     76.4     1     72.8     28.4
#&gt; 2 Rais… secs      1360  16        3        73.2     0.9   70.3     36  
#&gt; # ℹ 9 more variables: Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;, Magnesium &lt;dbl&gt;,
#&gt; #   Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;, BetaCarotene &lt;dbl&gt;,
#&gt; #   VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

<p class="forceBreak">

</p>

<p>Avec les fonctions classiques.</p>

<pre class = 'prettyprint lang-r'>fruits[fruits$Sucres &gt; 60, ]
#&gt; # A tibble: 2 × 18
#&gt;   nom   groupe Energie   Eau Proteines Glucides Lipides Sucres Fructose
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Cann… secs      1410  14.6      0.25     76.4     1     72.8     28.4
#&gt; 2 Rais… secs      1360  16        3        73.2     0.9   70.3     36  
#&gt; # ℹ 9 more variables: Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;, Magnesium &lt;dbl&gt;,
#&gt; #   Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;, BetaCarotene &lt;dbl&gt;,
#&gt; #   VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Sélectionner des plages de lignes</h2></hgroup><article  id="sélectionner-des-plages-de-lignes" class="columns-2 smaller">

<p>Avec la fonction <code>slice</code>.</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  slice(3:10)
#&gt; # A tibble: 8 × 18
#&gt;   nom   groupe Energie   Eau Proteines Glucides Lipides Sucres Fructose
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Anan… exoti…     304  81.3      0.94    15.1     0.25   14.9     2.8 
#&gt; 2 Bana… exoti…     383  75.8      1.06    19.7     0.25   15.6     3.8 
#&gt; 3 Cann… secs      1410  14.6      0.25    76.4     1      72.8    28.4 
#&gt; 4 Ceri… crus       235  85.7      0.81    13       0.25   10       4.6 
#&gt; 5 Citr… crus       118  91.3      0.25     1.56    0.25    0.8     0.4 
#&gt; 6 Clem… crus       200  87        0.81     9.17    0.25    8.6     1.5 
#&gt; 7 Comp… compo…     279  82.9      0.25    15.3     0.08   14.6     6.92
#&gt; 8 Comp… compo…     432  72.9      0.23    24.4     0.21   20.7     7.9 
#&gt; # ℹ 9 more variables: Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;, Magnesium &lt;dbl&gt;,
#&gt; #   Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;, BetaCarotene &lt;dbl&gt;,
#&gt; #   VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

<p>Avec les fonctions classiques.</p>

<pre class = 'prettyprint lang-r'>fruits[3:10, ]
#&gt; # A tibble: 8 × 18
#&gt;   nom   groupe Energie   Eau Proteines Glucides Lipides Sucres Fructose
#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 Anan… exoti…     304  81.3      0.94    15.1     0.25   14.9     2.8 
#&gt; 2 Bana… exoti…     383  75.8      1.06    19.7     0.25   15.6     3.8 
#&gt; 3 Cann… secs      1410  14.6      0.25    76.4     1      72.8    28.4 
#&gt; 4 Ceri… crus       235  85.7      0.81    13       0.25   10       4.6 
#&gt; 5 Citr… crus       118  91.3      0.25     1.56    0.25    0.8     0.4 
#&gt; 6 Clem… crus       200  87        0.81     9.17    0.25    8.6     1.5 
#&gt; 7 Comp… compo…     279  82.9      0.25    15.3     0.08   14.6     6.92
#&gt; 8 Comp… compo…     432  72.9      0.23    24.4     0.21   20.7     7.9 
#&gt; # ℹ 9 more variables: Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;, Magnesium &lt;dbl&gt;,
#&gt; #   Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;, BetaCarotene &lt;dbl&gt;,
#&gt; #   VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Grouper des lignes</h2></hgroup><article  id="grouper-des-lignes" class="smaller">

<p>Avec la fonction <code>group_by</code> :</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% group_by(groupe)
#&gt; # A tibble: 51 × 18
#&gt; # Groups:   groupe [4]
#&gt;    nom           groupe Energie   Eau Proteines Glucides Lipides Sucres
#&gt;    &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 Abricot       crus       194  87.1      0.81     9.01    0.25    6.7
#&gt;  2 Abricot       secs      1010  24.7      2.88    59.1     0.5    34.3
#&gt;  3 Ananas        exoti…     304  81.3      0.94    15.1     0.25   14.9
#&gt;  4 Banane        exoti…     383  75.8      1.06    19.7     0.25   15.6
#&gt;  5 Canneberge    secs      1410  14.6      0.25    76.4     1      72.8
#&gt;  6 Cerise        crus       235  85.7      0.81    13       0.25   10  
#&gt;  7 Citron        crus       118  91.3      0.25     1.56    0.25    0.8
#&gt;  8 Clementine    crus       200  87        0.81     9.17    0.25    8.6
#&gt;  9 CompoteMulti… compo…     279  82.9      0.25    15.3     0.08   14.6
#&gt; 10 CompotePomme  compo…     432  72.9      0.23    24.4     0.21   20.7
#&gt; # ℹ 41 more rows
#&gt; # ℹ 10 more variables: Fructose &lt;dbl&gt;, Fibres &lt;dbl&gt;, Calcium &lt;dbl&gt;,
#&gt; #   Magnesium &lt;dbl&gt;, Phosphore &lt;dbl&gt;, Potassium &lt;dbl&gt;, Zinc &lt;dbl&gt;,
#&gt; #   BetaCarotene &lt;dbl&gt;, VitamineE &lt;dbl&gt;, VitamineC &lt;dbl&gt;</pre>

<p>Les données sont prêtes à être &ldquo;traitées&rdquo; groupe par groupe. PS : L’opération <code>ungroup()</code> permet d’enlever les groupes.</p>

</article></slide><slide class=""><hgroup><h2>Calculer une moyenne</h2></hgroup><article  id="calculer-une-moyenne" class="columns-2 smaller">

<p>Avec la fonction <code>summarize</code>.</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% 
  group_by(groupe) %&gt;%
  summarize(SucreMoyen = mean(Sucres))
#&gt; # A tibble: 4 × 2
#&gt;   groupe   SucreMoyen
#&gt;   &lt;chr&gt;         &lt;dbl&gt;
#&gt; 1 compote       15.5 
#&gt; 2 crus           9.68
#&gt; 3 exotique      11.4 
#&gt; 4 secs          55.0</pre>

<p>Avec les fonctions classiques.</p>

<pre class = 'prettyprint lang-r'>aggregate(fruits$Sucres, 
          by = list(fruits$groupe), 
          FUN = mean)
#&gt;    Group.1         x
#&gt; 1  compote 15.533333
#&gt; 2     crus  9.684242
#&gt; 3 exotique 11.380000
#&gt; 4     secs 54.980000</pre>

</article></slide><slide class=""><hgroup><h2>Exercice(s)</h2></hgroup><article  id="exercices">

<p>Calculer l’énergie moyenne, la teneur en sucres médiane et le maximum de la teneur en Fibres par groupe de fruits et trier le tout par ordre décroissant du maximum de la teneur en Fibres !</p>

</article></slide><slide class=""><hgroup><h2>Deux autres fonctions pour sélectionner ou transformer des colonnes</h2></hgroup><article  id="deux-autres-fonctions-pour-sélectionner-ou-transformer-des-colonnes" class="columns-2 center">

<table class = 'rmdtable'>
<tr class="odd">
<td align="left"></td>
<td align="left">Sélectionne</td>
<td align="left">Ne sélectionne pas</td>
</tr>
<tr class="even">
<td align="left">Ne transforme pas</td>
<td align="left"><code>select</code></td>
<td align="left"><code>rename</code></td>
</tr>
<tr class="odd">
<td align="left">Peut transformer</td>
<td align="left"><code>transmute</code></td>
<td align="left"><code>mutate</code></td>
</tr>
</table>

<p class="forceBreak">

</p>

<img width="100%" src='img/S04dplyr/DavidRobinson.png' title=''/>

</article></slide><slide class=""><hgroup><h2>Compter</h2></hgroup><article  id="compter" class="columns-2">

<p>Avec le &ldquo;verbe&rdquo; <code>count</code> :</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;% count(groupe)
#&gt; # A tibble: 4 × 2
#&gt;   groupe       n
#&gt;   &lt;chr&gt;    &lt;int&gt;
#&gt; 1 compote      3
#&gt; 2 crus        33
#&gt; 3 exotique    10
#&gt; 4 secs         5</pre>

<p class="forceBreak">

</p>

<p>On peut ensuite ranger les résultats par ordre décroissant :</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;%
  count(groupe) %&gt;%
  arrange(desc(n))
#&gt; # A tibble: 4 × 2
#&gt;   groupe       n
#&gt;   &lt;chr&gt;    &lt;int&gt;
#&gt; 1 crus        33
#&gt; 2 exotique    10
#&gt; 3 secs         5
#&gt; 4 compote      3</pre>

</article></slide><slide class=""><hgroup><h2>Intermède : la fonction cut</h2></hgroup><article  id="intermède-la-fonction-cut">

<p>La fonction <code>cut</code> permet de transformer un vecteur de valeurs numériques en un facteur contenant des <strong>intervalles</strong> :</p>

<ul>
<li><code>x</code> : le vecteur de valeurs numériques,</li>
<li><code>breaks</code> : les limites des intervalles.</li>
</ul>

<p>Exemple :</p>

<pre class = 'prettyprint lang-r'>entiers &lt;- 1:5
cut(entiers, c(0, 2, 5))
#&gt; [1] (0,2] (0,2] (2,5] (2,5] (2,5]
#&gt; Levels: (0,2] (2,5]</pre>

</article></slide><slide class=""><hgroup><h2>Compter deux choses à la fois</h2></hgroup><article  id="compter-deux-choses-à-la-fois">

<p>Par exemple, compter dans chaque groupe le nombre de fruits dont la teneur en Vitamine C est inférieure ou supérieure à 50 :</p>

<pre class = 'prettyprint lang-r'>fruits %&gt;%
  mutate(VitCqual = cut(VitamineC, c(0, 50, 100))) %&gt;%
  count(groupe, VitCqual, name = &quot;N&quot;)
#&gt; # A tibble: 6 × 3
#&gt;   groupe   VitCqual     N
#&gt;   &lt;chr&gt;    &lt;fct&gt;    &lt;int&gt;
#&gt; 1 compote  (0,50]       3
#&gt; 2 crus     (0,50]      32
#&gt; 3 crus     (50,100]     1
#&gt; 4 exotique (0,50]       7
#&gt; 5 exotique (50,100]     3
#&gt; 6 secs     (0,50]       5</pre>

</article></slide><slide class=""><hgroup><h2>Super bonus : la table de contingence</h2></hgroup><article  id="super-bonus-la-table-de-contingence">

<p>Ce n’est pas facile, il vaut mieux utiliser la fonction <code>table</code> :</p>

<pre class = 'prettyprint lang-r'>library(tidyr)
fruits %&gt;%
  mutate(VitCqual = cut(VitamineC, c(0, 50, 100))) %&gt;%
  count(groupe, VitCqual, name = &quot;N&quot;) %&gt;%
  pivot_wider(id_cols = groupe, 
              names_from = VitCqual, 
              values_from = N)
#&gt; # A tibble: 4 × 3
#&gt;   groupe   `(0,50]` `(50,100]`
#&gt;   &lt;chr&gt;       &lt;int&gt;      &lt;int&gt;
#&gt; 1 compote         3         NA
#&gt; 2 crus           32          1
#&gt; 3 exotique        7          3
#&gt; 4 secs            5         NA</pre>

</article></slide><slide class="segue nobackground level1 fill" style="background: #ffffff;"><hgroup class = 'auto-fadein'><h2>D’autres fonctions utiles en bonus</h2></hgroup><article  id="dautres-fonctions-utiles-en-bonus">

<p>Avec les illustrations de Allison Horst (<a href='https://www.allisonhorst.com/' title=''>https://www.allisonhorst.com/</a>)</p>

</article></slide><slide class=""><hgroup><h2></h2></hgroup><article  id="section-1">

<img width="100%" src='img/S04dplyr/dplyr_relocate.jpeg' title=''/>

</article></slide><slide class=""><hgroup><h2></h2></hgroup><article  id="section-2">

<img width="100%" src='img/S04dplyr/dplyr_across.jpeg' title=''/>

</article></slide><slide class=""><hgroup><h2></h2></hgroup><article  id="section-3">

<img width="100%" src='img/S04dplyr/dplyr_case_when.jpeg' title=''/>

</article></slide><slide class="segue nobackground level1 fill" style="background: #ffffff;"><hgroup class = 'auto-fadein'><h2><a href='https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf' title=''>Il y a tellement d’autres fonctions !</a></h2></hgroup><article  id="il-y-a-tellement-dautres-fonctions">

<img width="50%" src='img/S04dplyr/cheatsheet.png' title=''/></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
    if (window.Shiny) {
      // Initialize slides when this script appears on the page, since it
      // indicates that the <slides> markup has been fully loaded.
      window.loadDeck();
    }
  })();
</script>

</body>
</html>
