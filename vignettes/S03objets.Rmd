---
title: "Commandes et objets de base"
author: "Vincent Guillemot<br/>Amaury Vaysse"
date: "Lundi 15/11/2021"
output: 
  ioslides_presentation:
    css: styles.css
vignette: >
  %\VignetteIndexEntry{02dplyr}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

<style>
.forceBreak { -webkit-column-break-after: always; break-after: column; }
</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE
)
library(ggplot2)
library(tidyr)
```

## Bien se préparer à coder

  * Créer un projet dans ce dossier : 
     * Bien réfléchir au nom de ce projet
     * Bien réfléchir à l'endroit où ce projet sera situé
  * Créer un script
  * Savoir où sont les données, et sous quel format
  * Savoir ce que l'on veut faire !
  
# C'est parti pour les commandes de base !

## Le(s) prompt(s)

  * `>` : R attend une commande à exécuter
  * `+` : la commande qui a été entrée n'est pas complète car
    * il manque une parenthèse fermante
    * il manque un crochet fermant
    * il manque une accolade fermante
  * ` ` : la commande est en cours de traitement. On peut l'arrêter en cliquant sur le bouton "Stop"

## Une commande, c'est quoi ?

C'est une séquence d'opérations appliquées à des objets ou des valeurs qui sera donnée au compilateur de R pour interprétation.

  * "opération" : permet de transformer des entrées en sorties, p.ex. : la fonction `log`;
  * "objets" : structures de données, p.ex. : plus tard ;
  * "valeurs" : des briques de base, p.ex. : la valeur `0`. 

Une fois la commande écrite dans la console, on l'exécute en appuyant sur "Entrée".

## Exercice

Exécutez les commandes suivantes : 

  1. `1 + 1`
  2. `1+1`
  3. `log(10)`
  4. `log10(10)`

Remarquez l'utilisation des parenthèses pour appliquer une fonction !

## Opérations de base

On peut effectuer toutes les opérations de base en R : 

  * addition (`+`), soustraction (`-`), multiplication (`*`), division (`/`), exponentiation (`**` ou `^`)...
  
appliquer les fonctions mathématiques de base :

  * logarithme (`log`, `log2`, `log10`), exponentielle (`exp`) sinus (`sin`), cosinus (`cos`), tangente (`tan`)
  
On peut combiner les opérations et les fonctions, et gérer les priorités avec des parenthèses !

## Exercice

Imaginez une commande incluant le plus d'opérations et de fonctions de base et dont le résultat serait 2 !

## Un opérateur bien pratique, le `:`

Comment créer une suite d'entier ?

  * `c(1, 2, 3, 4)`
  * `seq(1, 4, 1`
  * `1:4`

L'opérateur `:` est très utilisé en R. Sa syntaxe est la suivante

  * $i$`:`$j$ va créer une suite d'entiers de $i$ à $j$. Les entiers peuvent être négatifs ou positifs, et on peut peut avoir $i < j$ ou $i > j$, ou même $i = j$.

Attention à bien mettre des **parenthèses** dans le cas d'entiers négatifs!

## Exemples

 * `3:7` : les entiers de 3 à 7
 * `7:3` : les entiers de 7 à 7
 * `-3:7` : les entiers de -3 à 7
 * `-3:-7` : les entiers de -3 à -7
 * `-(3:7)` : les entiers de -3 à -7
 
## Exercice

 1. Créez un vecteur d'entiers de 0 à 3
 2. Créez un autre vecteur d'entiers de 3 à 1
 3. *Combinez* ces deux suites pour obtenir le vecteur suivant :
 
```{r vecteur, echo = FALSE, results='asis'}
pander::pandoc.table(c(3:1, 0:3))
```

## Assignation avec `<-`

Comment "sauvegarder" ces objets ?

En utilisant l'**opérateur d'assignation**

```{r assign, echo = FALSE, fig.width = 3, fig.height = 3, fig.align='center'}
data.frame(x = 0, y = 0, lab = "<-") %>% 
  ggplot(aes(x, y, label = lab)) + 
  geom_text(size = 50, family = "Courier", fontface = "bold") + 
  theme_void() + 
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))
```

## Utilisation de l'opération d'assignation

 * A gauche : l'objet que l'on veut créer
 * A droite : sa définition
 * Lecture de l'opération : "assigner à cet objet (à gauche) le résultat de cette commande (à droite)"
 * Assigner deux fois de suite écrasera la première valeur assignée
 * Alternative : `=`
 * Exemples : `a <- 1`, `b <- 1:10`, `a <- 2` etc.
 
## Les noms d'objets

Règles absolues : 

 * Commence par une lettre ou un point, si le premier caractère est un point, le deuxième ne peut pas être un chiffre,
 * Pas d'espace
 * Pas de caractères correspondant à des opérations (`+`, `-`, `*`, `/`, `^`, `**`, etc.)
 * Les minuscules et les majuscules sont différentes !
 * Certains "mots-clefs" sont strictement interdits (`NA`, `TRUE`, `FALSE`, `for`, `if`, `else` etc.)
 * MAIS on peut utiliser un nom d'objet qui existe déjà !

Bonnes pratiques : 

 * Utiliser un nom qui a du sens
 * Ne pas utiliser des noms  d'objets qui existent déjà et que l'on ne souhaite pas écraser !

## Mini exercice

 1. Créez un vecteur d'entiers de 0 à 3, appelez le `a`
 2. Créez un autre vecteur d'entiers de 3 à 1, appelez le `b`
 3. *Combinez* ces deux vecteurs pour obtenir un vecteur `ab` selon le modèle suivant :
 
```{r vecteur2, echo = FALSE, results='asis'}
pander::pandoc.table(c(3:1, 0:3))
```

## Opérations

On peut appliquer des opérations à ces "vecteurs" !

```{r}
a <- 1:5
a + 1
a * 2
```

Ces "vecteurs" sont des **objets**.

# Les Objets

## Classes d'objets

Nom | Appelation officielle | Exemple
---|---|---
Vecteur | ??? | `1:10`
Facteur | `factor` | `gl(2, 2)`
Matrice | `matrix` | `matrix(1:4, 2, 2)`  
Tableau | `data.frame` | `mtcars`  
Liste | `list` |  `list(a = 1, b = 1:10, c = "Hello!")`
Fonction | `function` | `sin`, `exp`, `log`


Pour connaître la classe d'un objet : `class(objet)`.


## Types de données

Nom | Appellation officielle | Exemple
---|---|---
Entier ($\mathbb Z$) | `integer` | `1:10`, (ou `1L`)
Réel ($\mathbb R$)  | `double` | `2.3`, `1/3`, etc...
Caractères | `character` | `month.name`, `"Bonjour"`
Booléen | `logical` | `TRUE`

## Bouh les quoi ?

> MATH., néol. Qui est relatif aux théories du logicien et mathématicien anglais George Boole.
>
> -- *Trésor de la Langue Française informatisé*


## "Classification" des objets


Les objets qui ne contiennent qu'un seul type de données : vecteurs et matrices.

Les objets pouvant contenir des données mixtes : tableaux et listes.

La flexibilité a un coût : on ne peut plus faire certaines opérations !

Les objets ayant des "dimensions" : vecteurs, tableaux et matrices

Les objets pour qui cela ne signifie rien ou presque : listes et fonctions

## Petit détour par les tableaux {.smaller}

```{r fruits}
data("fruits", package = "debuter")
fruits
```

## Importer des données en R

 * Des données de *packages* : `data`
 * Des données au format R (`RData`) : `load`
 * Des données "tabulées" : `read.table`
 * Des données Excel : `readxl::read_excel`
 * Des données Stata, SPSS, images etc.

## Les données "de R"

 * Utiliser la commande `data()` pour avoir une liste (presque ?) exhaustive.
 * Bonne pratique : pour charger un jeu de données, utiliser la commande complète `data("nom_des_data", package = "nom_du_package")`
 * Mais ces alternatives fonctionnent également : 
   + `data(mtcars)`
   + `DNase`
   + `library(ggplot2) ; data(diamonds)`
   
## Utilisation des guillemets

  * Obligation : quand l'argument doit être une chaîne de caractères
  * Oubli : `library`, `require`, `data`
  * Guillemets simples : fonctionnent comme les guillemets doubles. Ex.: `"bonjour"` est équivalent à `'bonjour'`.
  * Le "backtick" ou "backquote" : "`"

# Bref, c'est quoi un `tibble` ?

## Mise à jour de la table des classes d'objets !

Nom | Appelation officielle | Exemple
---|---|---
Vecteur | ??? | `1:10`
Facteur | `factor` | `gl(2, 2)`
Matrice | `matrix` | `matrix(1:4, 2, 2)`  
Tableau | `data.frame` | `mtcars`  
Tableau | `tibble` | `fruits`  
Liste | `list` |  `list(a = 1, b = 1:10, c = "Hello!")`
Fonction | `function` | `sin`, `exp`, `log`

## Explorer les données `fruits`

```{r brackets, echo = FALSE, fig.width = 6, fig.height = 4, fig.align='center'}
data.frame(x = c(0, 1, 0, 1), y = c(1, 1, 0, 0), lab = c("[ ]", "[ , ]", "[[ ]]", "$")) %>% 
  ggplot(aes(x, y, label = lab, color = lab)) + 
  geom_text(aes(hjust = x, vjust = y), size = 20, family = "Courier", fontface = "bold", show.legend = FALSE) + 
  theme_void() + 
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))
```

## Sur quels objets les utiliser ?

Opérateur | Vecteurs | Matrices | Tableaux | Listes
----------|:--------:|:--------:|:--------:|:------:
`[ ]`     |     x    |          |     x    |    x 
`[ , ]`   |          |     x    |     x    |    
`[[ ]]`   |          |          |     x    |    x 
`$`       |          |          |     x    |    x

## L'opérateur de sélection classique : `[ , ]`

  * Pour sélectioner la première ligne : `fruits[1, ]`
  * Pour sélectionner la deuxième colonne : `fruits[, 2]`
  * Pour enlever la troisième ligne : `fruits[-3, ]`
  * Pour enlever la quatrième colonne : `fruits[, -4]`
  
## Exercice

Comment faire pour sélectionner les fruits numéro 1, 3 et 5 ?

Je veux deux solutions : une "normale" et une "créative" !

## Sélectionner plusieurs lignes / colonnes

  * Pour sélectioner les lignes 1 et 3 : `fruits[c(1, 3), ]`
  * Pour sélectionner les colonnes 2 et 4 : `fruits[, c(2, 4)]`
  * Pour enlever les lignes 5 et 7 : `fruits[-c(5, 7), ]`
  * Pour enlever les colonnes 6 et 8 : `fruits[, -c(6, 8)]`

## 
